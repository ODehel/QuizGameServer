<Window x:Class="QuizGame.Presentation.Wpf.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:QuizGame.Presentation.Wpf"
        xmlns:converters="clr-namespace:QuizGame.Presentation.Wpf.Converters"
        mc:Ignorable="d"
        Title="QuizGame - Gestionnaire de Buzzers" Height="700" Width="1000"
        WindowStartupLocation="CenterScreen"
        Background="#F5F5F5">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="#2C3E50" Padding="20">
            <StackPanel Orientation="Vertical">
                <TextBlock Text="Gestionnaire de Buzzers QuizGame" 
                           FontSize="24" FontWeight="Bold" Foreground="White" Margin="0,0,0,10"/>
                <TextBlock Text="{Binding StatusMessage}" 
                           FontSize="14" Foreground="#ECF0F1"/>
            </StackPanel>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="1" Margin="20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="1*"/>
                <ColumnDefinition Width="1*"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel: Scan and Buzzers List -->
            <StackPanel Grid.Column="0" Margin="0,0,10,0">
                <!-- Scan Section -->
                <Border Background="White" CornerRadius="5" Padding="15" Margin="0,0,0,15">
                    <StackPanel>
                        <TextBlock Text="Scan réseau" FontSize="16" FontWeight="Bold" Margin="0,0,0,10"/>
                        <Button Command="{Binding ScanNetworkCommand}"
                                Content="{Binding ScanButtonText}"
                                Background="#3498DB" Foreground="White"
                                Padding="15,10" FontSize="14" FontWeight="Bold"
                                Cursor="Hand" Height="45"/>
                        <TextBlock Text="Scanne les périphériques commençant par 'Quiz'" 
                                   FontSize="11" Foreground="#7F8C8D" Margin="0,8,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Buzzers List -->
                <Border Background="White" CornerRadius="5" Padding="15">
                    <StackPanel>
                        <TextBlock Text="Périphériques détectés" FontSize="14" FontWeight="Bold" Margin="0,0,0,10"/>
                        <TextBlock Text="{Binding DiscoveredBuzzers.Count, StringFormat='Total: {0}'}" 
                                   FontSize="12" Foreground="#7F8C8D" Margin="0,0,0,10"/>
                        
                        <ListBox ItemsSource="{Binding DiscoveredBuzzers}"
                                 SelectedItem="{Binding SelectedBuzzer}"
                                 Background="#ECEFF1" BorderThickness="0" Height="400">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="White" CornerRadius="3" Padding="10" Margin="0,3">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                                <TextBlock Text="{Binding Name}" FontWeight="Bold" Foreground="#2C3E50"/>
                                                <TextBlock Text="{Binding IpAddress}" FontSize="11" Foreground="#7F8C8D"/>
                                                <TextBlock Text="{Binding MacAddress}" FontSize="10" Foreground="#BDC3C7"/>
                                            </StackPanel>

                                            <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="10,0,0,0">
                                                <TextBlock FontSize="12" FontWeight="Bold">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Setter Property="Foreground" Value="#7F8C8D"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding Status}" Value="Connected">
                                                                    <Setter Property="Foreground" Value="#27AE60"/>
                                                                    <Setter Property="Text" Value="✓ Connecté"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding Status}" Value="Disconnected">
                                                                    <Setter Property="Foreground" Value="#E74C3C"/>
                                                                    <Setter Property="Text" Value="✗ Déconnecté"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding Status}" Value="Connecting">
                                                                    <Setter Property="Foreground" Value="#F39C12"/>
                                                                    <Setter Property="Text" Value="↻ Connexion..."/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding Status}" Value="Error">
                                                                    <Setter Property="Foreground" Value="#C0392B"/>
                                                                    <Setter Property="Text" Value="⚠ Erreur"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </StackPanel>
                </Border>
            </StackPanel>

            <!-- Right Panel: Details and Logs -->
            <StackPanel Grid.Column="1" Margin="10,0,0,0">
                <!-- Details Section -->
                <Border Background="White" CornerRadius="5" Padding="15" Margin="0,0,0,15">
                    <StackPanel>
                        <TextBlock Text="Détails du buzzer sélectionné" FontSize="14" FontWeight="Bold" Margin="0,0,0,10"/>
                        
                        <StackPanel Opacity="{Binding SelectedBuzzer, Converter={StaticResource NullToOpacityConverter}}">
                            <StackPanel Margin="0,0,0,10">
                                <TextBlock Text="Nom:" FontWeight="Bold" Foreground="#2C3E50"/>
                                <TextBlock Text="{Binding SelectedBuzzer.Name}" Foreground="#7F8C8D"/>
                            </StackPanel>

                            <StackPanel Margin="0,0,0,10">
                                <TextBlock Text="Adresse IP:" FontWeight="Bold" Foreground="#2C3E50"/>
                                <TextBlock Text="{Binding SelectedBuzzer.IpAddress}" Foreground="#7F8C8D"/>
                            </StackPanel>

                            <StackPanel Margin="0,0,0,10">
                                <TextBlock Text="Adresse MAC:" FontWeight="Bold" Foreground="#2C3E50"/>
                                <TextBlock Text="{Binding SelectedBuzzer.MacAddress}" Foreground="#7F8C8D"/>
                            </StackPanel>

                            <StackPanel Margin="0,0,0,10">
                                <TextBlock Text="Port:" FontWeight="Bold" Foreground="#2C3E50"/>
                                <TextBlock Text="{Binding SelectedBuzzer.Port}" Foreground="#7F8C8D"/>
                            </StackPanel>

                            <StackPanel Margin="0,0,0,15">
                                <TextBlock Text="Statut:" FontWeight="Bold" Foreground="#2C3E50"/>
                                <TextBlock Text="{Binding SelectedBuzzer.Status}" Foreground="#7F8C8D"/>
                            </StackPanel>

                            <!-- Action Buttons -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="10"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <Button Grid.Column="0"
                                        Command="{Binding ConnectCommand}"
                                        Content="Connecter"
                                        Background="#27AE60" Foreground="White"
                                        Padding="15,8" FontSize="12" FontWeight="Bold"
                                        Cursor="Hand"/>
                                <Button Grid.Column="2"
                                        Command="{Binding DisconnectCommand}"
                                        Content="Déconnecter"
                                        Background="#E74C3C" Foreground="White"
                                        Padding="15,8" FontSize="12" FontWeight="Bold"
                                        Cursor="Hand"/>
                            </Grid>
                        </StackPanel>

                        <TextBlock Text="Sélectionnez un buzzer pour voir les détails" 
                                   FontSize="12" Foreground="#BDC3C7" TextAlignment="Center"
                                   Opacity="{Binding SelectedBuzzer, Converter={StaticResource NullToInverseOpacityConverter}}"/>
                    </StackPanel>
                </Border>

                <!-- Logs Section -->
                <Border Background="White" CornerRadius="5" Padding="15">
                    <StackPanel>
                        <Grid Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="Journal d'événements" FontSize="14" FontWeight="Bold"/>
                            <Button Grid.Column="1"
                                    Command="{Binding ClearLogsCommand}"
                                    Content="Effacer"
                                    Background="#95A5A6" Foreground="White"
                                    Padding="10,5" FontSize="11"
                                    Cursor="Hand"/>
                        </Grid>

                        <ListBox ItemsSource="{Binding EventLogs}"
                                 Background="#ECEFF1" BorderThickness="0" Height="320">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding DisplayText}" FontSize="11"
                                              Margin="5" TextWrapping="Wrap">
                                        <TextBlock.Foreground>
                                            <MultiBinding Converter="{StaticResource LogTypeToColorConverter}">
                                                <Binding Path="Type"/>
                                            </MultiBinding>
                                        </TextBlock.Foreground>
                                    </TextBlock>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </StackPanel>
                </Border>
            </StackPanel>
        </Grid>

        <!-- Footer -->
        <Border Grid.Row="2" Background="#34495E" Padding="20" BorderThickness="0,1,0,0" BorderBrush="#2C3E50">
            <TextBlock Text="QuizGame Server © 2024 - Prêt à communiquer avec les buzzers" 
                       Foreground="#ECF0F1" FontSize="12"/>
        </Border>
    </Grid>
</Window>
